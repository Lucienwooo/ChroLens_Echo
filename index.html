<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¿»è­¯</title>
    <style>
        /* å¼•å…¥ LINE Seed TW å­—å‹ï¼ˆRegularï¼‰ */
        @font-face {
            font-family: 'LINESeedTW';
            src: url('./LINE Seed TW_ver02/TTF/LINESeedTW_TTF_Rg.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        /* ä¸­æ–‡ç”¨ LINE Seed TWï¼Œè‹±æ–‡å’Œæ—¥æ–‡ç”¨å¾®è»Ÿæ­£é»‘é«” */
        body {
            font-family: 'LINESeedTW', 'Microsoft JhengHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        /* å¼·åˆ¶ä¸­æ–‡ç”¨ LINESeedTW */
        :lang(zh), :lang(zh-Hant), :lang(zh-TW) {
            font-family: 'LINESeedTW', 'Microsoft JhengHei', sans-serif;
        }
        /* è‹±æ–‡å’Œæ—¥æ–‡ç”¨å¾®è»Ÿæ­£é»‘é«” */
        :lang(en), :lang(ja) {
            font-family: 'Microsoft JhengHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        /* ç°¡å–®çš„éŸ¿æ‡‰å¼ CSSï¼Œç¢ºä¿æ‰‹æ©Ÿå’Œé›»è…¦éƒ½å¯ç”¨ */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; max-width: 800px; margin: auto; background-color: #f4f4f4; }
        h1 { text-align: center; color: #333; }
        .container { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        textarea { width: 100%; height: 150px; padding: 10px; margin-bottom: 10px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; resize: vertical; }
        select { padding: 10px; margin-right: 10px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; transition: background-color 0.3s; }
        button:hover { background-color: #0056b3; }
        #result-area { margin-top: 20px; padding: 15px; background-color: #e9ecef; border-radius: 4px; min-height: 50px; white-space: pre-wrap; }
        .controls { display: flex; align-items: center; margin-bottom: 20px; }
        .controls > * { margin-right: 10px; }
        #swap-btn { background-color: #6c757d; font-size: 1.2em; line-height: 1; padding: 5px 10px; }
        .language-group { flex-grow: 1; }
    </style>
</head>
<body>
    <h1>è‡ªç”¨ç„¡å»£å‘Šç¿»è­¯</h1>
    <div class="container">
        <div class="language-group">
            <label for="source-lang">ä¾†æºèªè¨€:</label>
            <select id="source-lang">
                <option value="auto">è‡ªå‹•åµæ¸¬</option>
                <option value="zh-tw" selected>ç¹é«”ä¸­æ–‡</option>
                <option value="ja">æ—¥æ–‡</option>
                <option value="en">è‹±æ–‡</option>
            </select>
        </div>
        <textarea id="input-text" placeholder="è«‹è¼¸å…¥è¦ç¿»è­¯çš„å¥å­æˆ–çŸ­æ–‡..." oninput="autoTranslate()"></textarea>

        <div class="controls">
            <div class="language-group">
                <label for="target-lang">ç›®æ¨™èªè¨€:</label>
                <select id="target-lang">
                    <option value="zh-tw">ç¹é«”ä¸­æ–‡</option>
                    <option value="ja" selected>æ—¥æ–‡</option>
                    <option value="en">è‹±æ–‡</option>
                </select>
            </div>
            <button id="swap-btn" onclick="swapLanguages()">â‡„</button>
            <button onclick="translateText()">æ‰‹å‹•ç¿»è­¯</button>
        </div>

        <h2>ç¿»è­¯çµæœ:</h2>
        <div id="result-area"></div>
        <p id="status-message" style="color: red;"></p>
    </div>

    <script>
        // æ­¥é©Ÿä¸€ï¼šå°‡æ‚¨çš„æ‰€æœ‰ Apps Script API ç¶²å€æ”¾åœ¨é€™å€‹é™£åˆ—ä¸­
        const API_URLS = [
            //umiwued
            "https://script.google.com/macros/s/AKfycbxSUTL_ztpG9JY2bYyZFWvmuzY9Kf6fJneZi1ddsZBO4s7OP8AHvqfBAbLhqTgmN84/exec",
            
            //yunari202505
            "https://script.google.com/macros/s/AKfycbzl--LvEA8pWCvwV5oXShC6dsmW4L8MC4KvNm2xmpQlTagP1toabvWfrTizRuuIGHtg/exec",
            
            //lucienwucloud
            "https://script.google.com/macros/s/AKfycbwtnn2V-O8MkQ-qvwGBtUwSoQGgGyFkHKFAYgUQg1DTMSVHlj68BgmRl2QbEsTNAekc/exec",

            //lucienwuuu
            "https://script.google.com/macros/s/AKfycbzjefXUT5qEe5YvpKZ1Gu-FK4UXyjeGLFGUDED_Mrm0dXEeEyQZifNRBQknlcGhVBfk/exec",

            //lucienwooo
            "https://script.google.com/macros/s/AKfycbwgcGENGItJiZPKDnmDT4_C0J0duRElp4A82xOm0f1_gXT5gCQJcg6nJLwj_QGwNZcv/exec"
        ]; 
        
        // ç”¨ä¾†è¿½è¹¤ç›®å‰ä½¿ç”¨åˆ°å“ªå€‹ API çš„ç´¢å¼•
        let currentApiIndex = 0;

        let lastInput = "";
        let timer = null;

        function swapLanguages() {
            const source = document.getElementById('source-lang');
            const target = document.getElementById('target-lang');
            const tempTargetValue = target.value; 

            if (source.value !== 'auto') {
                target.value = source.value;
                source.value = tempTargetValue;
            } else {
                source.value = tempTargetValue;
                target.value = 'auto'; 
            }
            translateText();
        }

        function autoTranslate() {
            if (timer) {
                clearTimeout(timer);
            }
            timer = setTimeout(translateText, 500); 
        }

        function openGoogleTranslateFallback(text, sourceLang, targetLang) {
            const googleTranslateUrl = `https://translate.google.com/?sl=${sourceLang === 'auto' ? 'auto' : sourceLang}&tl=${targetLang}&text=${encodeURIComponent(text)}&op=translate`;
            window.open(googleTranslateUrl, '_blank');
        }
        
        async function translateText() {
            // æ¯æ¬¡ç¿»è­¯éƒ½å…ˆæ›ä¸‹ä¸€å€‹ API (ç¢ºä¿è² è¼‰å‡è¡¡)
            currentApiIndex = (currentApiIndex + 1) % API_URLS.length;

            const text = document.getElementById('input-text').value.trim();
            const sourceLang = document.getElementById('source-lang').value;
            const targetLang = document.getElementById('target-lang').value;
            const resultArea = document.getElementById('result-area');
            const statusMessage = document.getElementById('status-message');

            if (text === "" || text === lastInput) {
                return;
            }
            lastInput = text;
            resultArea.innerText = "ç¿»è­¯ä¸­...";
            statusMessage.innerText = "";
            
            let success = false;
            let attempts = 0;
            const maxAttempts = API_URLS.length;

            while (attempts < maxAttempts && !success) {
                const currentApiUrl = API_URLS[currentApiIndex];
                const url = `${currentApiUrl}?text=${encodeURIComponent(text)}&source=${sourceLang}&target=${targetLang}`;
                
                console.log(`å˜—è©¦ä½¿ç”¨ API ç´¢å¼•: ${currentApiIndex}`);
                
                try {
                    const response = await fetch(url);
                    const data = await response.json();

                    if (data.status === 'success') {
                        resultArea.innerText = data.translatedText;
                        statusMessage.innerText = `âœ… ç¿»è­¯æˆåŠŸ (API ç´¢å¼•: ${currentApiIndex})`;
                        success = true;
                    } else if (data.status === 'limit_exceeded') {
                        resultArea.innerText = `âš ï¸ API ${currentApiIndex} é¡åº¦ç”¨ç›¡ï¼Œè‡ªå‹•åˆ‡æ›è‡³ä¸‹ä¸€å€‹ API...`;
                        statusMessage.innerText = `éŒ¯èª¤: ${data.message}`;
                    } else {
                        resultArea.innerText = `âŒ API ${currentApiIndex} ç™¼ç”Ÿä¸€èˆ¬éŒ¯èª¤ï¼Œå˜—è©¦ä¸‹ä¸€å€‹...`;
                        statusMessage.innerText = `éŒ¯èª¤: ${data.message}`;
                    }

                } catch (error) {
                    resultArea.innerText = `ğŸŒ API ${currentApiIndex} é€£ç·šå¤±æ•—ï¼Œå˜—è©¦ä¸‹ä¸€å€‹...`;
                    statusMessage.innerText = `ç¶²è·¯éŒ¯èª¤: ${error.message}`;
                }

                currentApiIndex = (currentApiIndex + 1) % API_URLS.length;
                attempts++;
            }
            
            if (!success) {
                resultArea.innerText = "âŒ å…è²»é¡åº¦å·²å…¨éƒ¨ç”¨ç›¡æˆ–é€£ç·šå¤±æ•—ï¼è‡ªå‹•é–‹å•Ÿ Google ç¿»è­¯å‚™æ´ã€‚";
                statusMessage.innerText = "è«‹åœ¨æ–°è¦–çª—/æ¨™ç±¤é ä¸­æŸ¥çœ‹ç¿»è­¯çµæœã€‚";
                openGoogleTranslateFallback(text, sourceLang, targetLang);
            }
        }

        window.onload = translateText; 
    </script>
</body>
</html>