
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>翻譯</title>
    <style>
        /* 簡單的響應式 CSS，確保手機和電腦都可用 */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; max-width: 800px; margin: auto; background-color: #f4f4f4; }
        h1 { text-align: center; color: #333; }
        .container { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        textarea { width: 100%; height: 150px; padding: 10px; margin-bottom: 10px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; resize: vertical; }
        select { padding: 10px; margin-right: 10px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; transition: background-color 0.3s; }
        button:hover { background-color: #0056b3; }
        #result-area { margin-top: 20px; padding: 15px; background-color: #e9ecef; border-radius: 4px; min-height: 50px; white-space: pre-wrap; }
        .controls { display: flex; align-items: center; margin-bottom: 20px; }
        .controls > * { margin-right: 10px; }
        #swap-btn { background-color: #6c757d; font-size: 1.2em; line-height: 1; padding: 5px 10px; }
        .language-group { flex-grow: 1; }
    </style>
</head>
<body>
    <h1>自用無廣告翻譯</h1>
    <div class="container">
        <div class="language-group">
            <label for="source-lang">來源語言:</label>
            <select id="source-lang">
                <option value="auto">自動偵測</option>
                <option value="zh-tw" selected>繁體中文</option>
                <option value="ja">日文</option>
                <option value="en">英文</option>
            </select>
        </div>
        <textarea id="input-text" placeholder="請輸入要翻譯的句子或短文..." oninput="autoTranslate()"></textarea>

        <div class="controls">
            <div class="language-group">
                <label for="target-lang">目標語言:</label>
                <select id="target-lang">
                    <option value="zh-tw">繁體中文</option>
                    <option value="ja" selected>日文</option>
                    <option value="en">英文</option>
                </select>
            </div>
            <button id="swap-btn" onclick="swapLanguages()">⇄</button>
            <button onclick="translateText()">手動翻譯</button>
        </div>

        <h2>翻譯結果:</h2>
        <div id="result-area"></div>
        <p id="status-message" style="color: red;"></p>
    </div>

    <script>
        // 替換成您在 Apps Script 步驟中得到的網址！
        const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxSUTL_ztpG9JY2bYyZFWvmuzY9Kf6fJneZi1ddsZBO4s7OP8AHvqfBAbLhqTgmN84/exec"; 

        let lastInput = "";
        let timer = null;

        function swapLanguages() {
            const source = document.getElementById('source-lang');
            const target = document.getElementById('target-lang');

            // 暫存 target 的值
            const tempTargetValue = target.value; 

            // 如果來源不是「自動偵測」，則交換
            if (source.value !== 'auto') {
                target.value = source.value;
                source.value = tempTargetValue;
            } else {
                // 如果來源是「自動偵測」，只將目標語言設為來源，來源仍為自動
                source.value = tempTargetValue; // 這樣會讓原本的目標變成新的來源
                target.value = 'auto'; // 新的目標變成自動偵測 (可依喜好調整，這裡簡單處理)
            }

            // 交換後自動翻譯一次
            translateText();
        }

        function autoTranslate() {
            if (timer) {
                clearTimeout(timer);
            }
            // 延遲 500 毫秒 (0.5 秒) 後才觸發翻譯，避免打字時頻繁呼叫
            timer = setTimeout(translateText, 500); 
        }

        async function translateText() {
            const text = document.getElementById('input-text').value.trim();
            const sourceLang = document.getElementById('source-lang').value;
            const targetLang = document.getElementById('target-lang').value;
            const resultArea = document.getElementById('result-area');
            const statusMessage = document.getElementById('status-message');

            if (text === "" || text === lastInput) {
                return; // 避免重複翻譯或空內容
            }
            lastInput = text;
            resultArea.innerText = "翻譯中...";
            statusMessage.innerText = "";

            // 建構 API 請求網址
            const url = `${GAS_WEB_APP_URL}?text=${encodeURIComponent(text)}&source=${sourceLang}&target=${targetLang}`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                if (data.status === 'success') {
                    resultArea.innerText = data.translatedText;
                } else {
                    resultArea.innerText = "翻譯失敗，請檢查 API 設定或稍後再試。";
                    statusMessage.innerText = `錯誤: ${data.message}`;
                }

            } catch (error) {
                resultArea.innerText = "連線錯誤，無法取得翻譯結果。";
                statusMessage.innerText = `網路或伺服器錯誤: ${error.message}`;
            }
        }

        // 初始執行一次手動翻譯，確保載入時狀態正確
        window.onload = translateText; 
    </script>
</body>
</html>