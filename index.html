
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¿»è­¯</title>
    <style>
        /* ç°¡å–®çš„éŸ¿æ‡‰å¼ CSSï¼Œç¢ºä¿æ‰‹æ©Ÿå’Œé›»è…¦éƒ½å¯ç”¨ */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; max-width: 800px; margin: auto; background-color: #f4f4f4; }
        h1 { text-align: center; color: #333; }
        .container { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        textarea { width: 100%; height: 150px; padding: 10px; margin-bottom: 10px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; resize: vertical; }
        select { padding: 10px; margin-right: 10px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; transition: background-color 0.3s; }
        button:hover { background-color: #0056b3; }
        #result-area { margin-top: 20px; padding: 15px; background-color: #e9ecef; border-radius: 4px; min-height: 50px; white-space: pre-wrap; }
        .controls { display: flex; align-items: center; margin-bottom: 20px; }
        .controls > * { margin-right: 10px; }
        #swap-btn { background-color: #6c757d; font-size: 1.2em; line-height: 1; padding: 5px 10px; }
        .language-group { flex-grow: 1; }
    </style>
</head>
<body>
    <h1>è‡ªç”¨ç„¡å»£å‘Šç¿»è­¯</h1>
    <div class="container">
        <div class="language-group">
            <label for="source-lang">ä¾†æºèªè¨€:</label>
            <select id="source-lang">
                <option value="auto">è‡ªå‹•åµæ¸¬</option>
                <option value="zh-tw" selected>ç¹é«”ä¸­æ–‡</option>
                <option value="ja">æ—¥æ–‡</option>
                <option value="en">è‹±æ–‡</option>
            </select>
        </div>
        <textarea id="input-text" placeholder="è«‹è¼¸å…¥è¦ç¿»è­¯çš„å¥å­æˆ–çŸ­æ–‡..." oninput="autoTranslate()"></textarea>

        <div class="controls">
            <div class="language-group">
                <label for="target-lang">ç›®æ¨™èªè¨€:</label>
                <select id="target-lang">
                    <option value="zh-tw">ç¹é«”ä¸­æ–‡</option>
                    <option value="ja" selected>æ—¥æ–‡</option>
                    <option value="en">è‹±æ–‡</option>
                </select>
            </div>
            <button id="swap-btn" onclick="swapLanguages()">â‡„</button>
            <button onclick="translateText()">æ‰‹å‹•ç¿»è­¯</button>
        </div>

        <h2>ç¿»è­¯çµæœ:</h2>
        <div id="result-area"></div>
        <p id="status-message" style="color: red;"></p>
    </div>

    <script>
        // æ­¥é©Ÿä¸€ï¼šå°‡æ‚¨çš„æ‰€æœ‰ Apps Script API ç¶²å€æ”¾åœ¨é€™å€‹é™£åˆ—ä¸­
        const API_URLS = [
            //umiwued
            "https://script.google.com/macros/s/AKfycbxSUTL_ztpG9JY2bYyZFWvmuzY9Kf6fJneZi1ddsZBO4s7OP8AHvqfBAbLhqTgmN84/exec",
            
            //yunari202505
            "https://script.google.com/macros/s/AKfycbzl--LvEA8pWCvwV5oXShC6dsmW4L8MC4KvNm2xmpQlTagP1toabvWfrTizRuuIGHtg/exec",
            
            //lucienwucloud
            "https://script.google.com/macros/s/AKfycbwtnn2V-O8MkQ-qvwGBtUwSoQGgGyFkHKFAYgUQg1DTMSVHlj68BgmRl2QbEsTNAekc/exec"
        ]; 
        
        // ç”¨ä¾†è¿½è¹¤ç›®å‰ä½¿ç”¨åˆ°å“ªå€‹ API çš„ç´¢å¼•
        let currentApiIndex = 0;

        let lastInput = "";
        let timer = null;

        function swapLanguages() {
            // ... (ä¿æŒåŸæœ‰çš„èªè¨€äº¤æ›é‚è¼¯ä¸è®Š)
        }

        function autoTranslate() {
            // ... (ä¿æŒåŸæœ‰çš„å»¶é²ç¿»è­¯é‚è¼¯ä¸è®Š)
        }
        
        async function translateText() {
            const text = document.getElementById('input-text').value.trim();
            const sourceLang = document.getElementById('source-lang').value;
            const targetLang = document.getElementById('target-lang').value;
            const resultArea = document.getElementById('result-area');
            const statusMessage = document.getElementById('status-message');

            if (text === "" || text === lastInput) {
                return;
            }
            lastInput = text;
            resultArea.innerText = "ç¿»è­¯ä¸­...";
            statusMessage.innerText = "";
            
            let success = false;
            let attempts = 0;
            const maxAttempts = API_URLS.length; // æœ€å¤šå˜—è©¦æ‰€æœ‰ API ä¸€æ¬¡

            // --- æ ¸å¿ƒï¼šå˜—è©¦è¼ªæ›¿å‘¼å« API ---
            while (attempts < maxAttempts && !success) {
                
                // 1. å–å¾—æœ¬æ¬¡è¦ä½¿ç”¨çš„ API ç¶²å€
                const currentApiUrl = API_URLS[currentApiIndex];
                
                // 2. å»ºæ§‹è«‹æ±‚ç¶²å€
                const url = `${currentApiUrl}?text=${encodeURIComponent(text)}&source=${sourceLang}&target=${targetLang}`;
                
                console.log(`å˜—è©¦ä½¿ç”¨ API ç´¢å¼•: ${currentApiIndex}`); // åœ¨ç€è¦½å™¨æ§åˆ¶å°æŸ¥çœ‹è¼ªæ›¿æƒ…æ³
                
                try {
                    const response = await fetch(url);
                    const data = await response.json();

                    if (data.status === 'success') {
                        // æˆåŠŸï¼šé¡¯ç¤ºçµæœä¸¦çµæŸè¼ªæ›¿
                        resultArea.innerText = data.translatedText;
                        statusMessage.innerText = `âœ… ç¿»è­¯æˆåŠŸ (API ç´¢å¼•: ${currentApiIndex})`;
                        success = true; // è¨­ç½®æˆåŠŸæ¨™èªŒ
                    } else if (data.status === 'limit_exceeded') {
                        // é¡åº¦ç”¨ç›¡ï¼šè·³éé€™å€‹ APIï¼Œå˜—è©¦ä¸‹ä¸€å€‹
                        resultArea.innerText = `âš ï¸ API ${currentApiIndex} é¡åº¦ç”¨ç›¡ï¼Œè‡ªå‹•åˆ‡æ›è‡³ä¸‹ä¸€å€‹ API...`;
                        statusMessage.innerText = `éŒ¯èª¤: ${data.message}`;
                    } else {
                        // å…¶ä»–éŒ¯èª¤ï¼šå¯èƒ½æ˜¯è¨­å®šéŒ¯èª¤ï¼Œä¹Ÿå˜—è©¦ä¸‹ä¸€å€‹
                        resultArea.innerText = `âŒ API ${currentApiIndex} ç™¼ç”Ÿä¸€èˆ¬éŒ¯èª¤ï¼Œå˜—è©¦ä¸‹ä¸€å€‹...`;
                        statusMessage.innerText = `éŒ¯èª¤: ${data.message}`;
                    }

                } catch (error) {
                    // é€£ç·šéŒ¯èª¤ï¼šç¶²è·¯éŒ¯èª¤æˆ–ç¶²å€éŒ¯èª¤ï¼Œä¹Ÿå˜—è©¦ä¸‹ä¸€å€‹
                    resultArea.innerText = `ğŸŒ API ${currentApiIndex} é€£ç·šå¤±æ•—ï¼Œå˜—è©¦ä¸‹ä¸€å€‹...`;
                    statusMessage.innerText = `ç¶²è·¯éŒ¯èª¤: ${error.message}`;
                }

                // 3. æº–å‚™ä¸‹ä¸€æ¬¡å˜—è©¦ï¼šç§»å‹•åˆ°ä¸‹ä¸€å€‹ API (è¼ªæ›¿æ©Ÿåˆ¶)
                currentApiIndex = (currentApiIndex + 1) % API_URLS.length;
                attempts++;
            }
            // --- æ ¸å¿ƒè¼ªæ›¿çµæŸ ---
            
            if (!success) {
                // æ‰€æœ‰ API éƒ½å˜—è©¦å¤±æ•—
                resultArea.innerText = "âŒ æ‰€æœ‰å‚™ç”¨ API çš†ç„¡æ³•ç¿»è­¯æˆ–é¡åº¦å·²ç”¨ç›¡ï¼Œè«‹æ˜å¤©å†è©¦ã€‚";
                statusMessage.innerText = ""; // æ¸…ç©ºè¼ªæ›¿éç¨‹ä¸­çš„éŒ¯èª¤è¨Šæ¯
            }
        }

        window.onload = translateText; 
    </script>
</body>
</html>