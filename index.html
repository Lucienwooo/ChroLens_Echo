
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>翻譯</title>
    <style>
        /* 簡單的響應式 CSS，確保手機和電腦都可用 */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; max-width: 800px; margin: auto; background-color: #f4f4f4; }
        h1 { text-align: center; color: #333; }
        .container { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        textarea { width: 100%; height: 150px; padding: 10px; margin-bottom: 10px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; resize: vertical; }
        select { padding: 10px; margin-right: 10px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; transition: background-color 0.3s; }
        button:hover { background-color: #0056b3; }
        #result-area { margin-top: 20px; padding: 15px; background-color: #e9ecef; border-radius: 4px; min-height: 50px; white-space: pre-wrap; }
        .controls { display: flex; align-items: center; margin-bottom: 20px; }
        .controls > * { margin-right: 10px; }
        #swap-btn { background-color: #6c757d; font-size: 1.2em; line-height: 1; padding: 5px 10px; }
        .language-group { flex-grow: 1; }
    </style>
</head>
<body>
    <h1>自用無廣告翻譯</h1>
    <div class="container">
        <div class="language-group">
            <label for="source-lang">來源語言:</label>
            <select id="source-lang">
                <option value="auto">自動偵測</option>
                <option value="zh-tw" selected>繁體中文</option>
                <option value="ja">日文</option>
                <option value="en">英文</option>
            </select>
        </div>
        <textarea id="input-text" placeholder="請輸入要翻譯的句子或短文..." oninput="autoTranslate()"></textarea>

        <div class="controls">
            <div class="language-group">
                <label for="target-lang">目標語言:</label>
                <select id="target-lang">
                    <option value="zh-tw">繁體中文</option>
                    <option value="ja" selected>日文</option>
                    <option value="en">英文</option>
                </select>
            </div>
            <button id="swap-btn" onclick="swapLanguages()">⇄</button>
            <button onclick="translateText()">手動翻譯</button>
        </div>

        <h2>翻譯結果:</h2>
        <div id="result-area"></div>
        <p id="status-message" style="color: red;"></p>
    </div>

    <script>
        // 步驟一：將您的所有 Apps Script API 網址放在這個陣列中
        const API_URLS = [
            //umiwued
            "https://script.google.com/macros/s/AKfycbxSUTL_ztpG9JY2bYyZFWvmuzY9Kf6fJneZi1ddsZBO4s7OP8AHvqfBAbLhqTgmN84/exec",
            
            //yunari202505
            "https://script.google.com/macros/s/AKfycbzl--LvEA8pWCvwV5oXShC6dsmW4L8MC4KvNm2xmpQlTagP1toabvWfrTizRuuIGHtg/exec",
            
            //lucienwucloud
            "https://script.google.com/macros/s/AKfycbwtnn2V-O8MkQ-qvwGBtUwSoQGgGyFkHKFAYgUQg1DTMSVHlj68BgmRl2QbEsTNAekc/exec"
        ]; 
        
        // 用來追蹤目前使用到哪個 API 的索引
        let currentApiIndex = 0;

        let lastInput = "";
        let timer = null;

        function swapLanguages() {
            // ... (保持原有的語言交換邏輯不變)
        }

        function autoTranslate() {
            // ... (保持原有的延遲翻譯邏輯不變)
        }
        
        async function translateText() {
            const text = document.getElementById('input-text').value.trim();
            const sourceLang = document.getElementById('source-lang').value;
            const targetLang = document.getElementById('target-lang').value;
            const resultArea = document.getElementById('result-area');
            const statusMessage = document.getElementById('status-message');

            if (text === "" || text === lastInput) {
                return;
            }
            lastInput = text;
            resultArea.innerText = "翻譯中...";
            statusMessage.innerText = "";
            
            let success = false;
            let attempts = 0;
            const maxAttempts = API_URLS.length; // 最多嘗試所有 API 一次

            // --- 核心：嘗試輪替呼叫 API ---
            while (attempts < maxAttempts && !success) {
                
                // 1. 取得本次要使用的 API 網址
                const currentApiUrl = API_URLS[currentApiIndex];
                
                // 2. 建構請求網址
                const url = `${currentApiUrl}?text=${encodeURIComponent(text)}&source=${sourceLang}&target=${targetLang}`;
                
                console.log(`嘗試使用 API 索引: ${currentApiIndex}`); // 在瀏覽器控制台查看輪替情況
                
                try {
                    const response = await fetch(url);
                    const data = await response.json();

                    if (data.status === 'success') {
                        // 成功：顯示結果並結束輪替
                        resultArea.innerText = data.translatedText;
                        statusMessage.innerText = `✅ 翻譯成功 (API 索引: ${currentApiIndex})`;
                        success = true; // 設置成功標誌
                    } else if (data.status === 'limit_exceeded') {
                        // 額度用盡：跳過這個 API，嘗試下一個
                        resultArea.innerText = `⚠️ API ${currentApiIndex} 額度用盡，自動切換至下一個 API...`;
                        statusMessage.innerText = `錯誤: ${data.message}`;
                    } else {
                        // 其他錯誤：可能是設定錯誤，也嘗試下一個
                        resultArea.innerText = `❌ API ${currentApiIndex} 發生一般錯誤，嘗試下一個...`;
                        statusMessage.innerText = `錯誤: ${data.message}`;
                    }

                } catch (error) {
                    // 連線錯誤：網路錯誤或網址錯誤，也嘗試下一個
                    resultArea.innerText = `🌐 API ${currentApiIndex} 連線失敗，嘗試下一個...`;
                    statusMessage.innerText = `網路錯誤: ${error.message}`;
                }

                // 3. 準備下一次嘗試：移動到下一個 API (輪替機制)
                currentApiIndex = (currentApiIndex + 1) % API_URLS.length;
                attempts++;
            }
            // --- 核心輪替結束 ---
            
            if (!success) {
                // 所有 API 都嘗試失敗
                resultArea.innerText = "❌ 所有備用 API 皆無法翻譯或額度已用盡，請明天再試。";
                statusMessage.innerText = ""; // 清空輪替過程中的錯誤訊息
            }
        }

        window.onload = translateText; 
    </script>
</body>
</html>